<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahtzee Enterprise v10.0</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #22c55e; 
            --warn: #ef4444; --info: #3b82f6; --highlight: #f59e0b; --gold: #fbbf24; 
        }

        /* HIDE INCREMENTAL BUTTONS (SPINNERS) */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* THEME DEFINITIONS */
        body.theme-plm { --bg: #f3f4f6; --card: #ffffff; --text: #1f2937; --info: #0284c7; --accent: #16a34a; }
        body.theme-80s { --bg: #2d005d; --card: #4a0080; --text: #00fff2; --info: #ff00ff; --accent: #00ff00; --highlight: #ffff00; }
        body.theme-matrix { --bg: #000000; --card: #0a0a0a; --text: #00ff41; --info: #008f11; --accent: #00ff41; --highlight: #003b00; }
        body.theme-cyberpunk { --bg: #0b0e14; --card: #1a1c23; --text: #00ff9f; --info: #00b8ff; --accent: #ff0055; --highlight: #fee715; }
        body.theme-nordic { --bg: #2e3440; --card: #3b4252; --text: #eceff4; --info: #88c0d0; --accent: #a3be8c; --highlight: #ebcb8b; }

        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 10px; display: flex; flex-direction: column; align-items: center; transition: all 0.3s ease; }
        .container { width: 95%; max-width: 1200px; background: var(--card); border-radius: 12px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); overflow-x: auto; }
        
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 10px 5px; text-align: center; border: 1px solid rgba(128,128,128,0.2); }
        th { background: rgba(0,0,0,0.2); font-size: 0.85em; text-transform: uppercase; color: var(--info); }
        .row-label { text-align: left; padding-left: 15px; font-weight: 600; width: 170px; background: rgba(0,0,0,0.1); color: var(--text); }
        
        .btn-remove { display: block; width: 100%; background: none; border: none; color: var(--warn); cursor: pointer; font-size: 0.7em; margin-top: 5px; text-decoration: underline; }
        
        input[type=number] { width: 70%; background: rgba(0,0,0,0.3); border: 1px solid rgba(128,128,128,0.4); color: var(--text); padding: 8px 0; border-radius: 4px; text-align: center; font-size: 1.1em; outline: none; }
        .btn-toggle { width: 80%; padding: 8px 0; border: 1px solid rgba(128,128,128,0.4); border-radius: 4px; background: rgba(0,0,0,0.3); color: var(--text); cursor: pointer; font-weight: bold; }
        .btn-toggle.scored { background: var(--accent); color: #fff; border-color: var(--accent); }
        .btn-toggle.zeroed { background: var(--warn); color: #fff; border-color: var(--warn); }

        .subtotal { background: rgba(0,0,0,0.15); font-weight: bold; }
        .grand-total { background: var(--info); color: #fff; font-weight: bold; font-size: 1.1em; }
        .leader-cell { border: 2px solid var(--gold) !important; box-shadow: inset 0 0 10px var(--gold); }
        .bonus-needed { font-size: 0.75em; color: var(--highlight); display: block; }

        .controls { margin-bottom: 15px; width: 95%; max-width: 1200px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: center; }
        button.action { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-add { background: var(--info); color: white; }
        .btn-reset { background: var(--warn); color: white; }
        
        select.theme-picker { padding: 8px; border-radius: 6px; background: var(--card); color: var(--text); border: 1px solid var(--info); }
        .empty-state { padding: 40px; text-align: center; opacity: 0.5; font-style: italic; }
    </style>
</head>
<body id="body">

    <h2 style="margin-bottom: 20px;">Yahtzee <span style="color:var(--info)">LOGIC</span> v10.0</h2>

    <div class="controls">
        <button class="action btn-add" onclick="addPlayer()">+ Add Player</button>
        <button class="action btn-reset" onclick="resetAllScores()">Reset Scores</button>
        <button class="action" style="background:#444; color:white;" onclick="hardReset()">Clear All Data</button>
        <select class="theme-picker" onchange="setTheme(this.value)" id="themeSelector">
            <option value="default">Midnight</option>
            <option value="theme-plm">PLM Dashboard</option>
            <option value="theme-80s">Neon 80s</option>
            <option value="theme-matrix">Matrix Terminal</option>
            <option value="theme-cyberpunk">Cyberpunk</option>
            <option value="theme-nordic">Nordic Frost</option>
        </select>
    </div>

    <div class="container" id="main-container">
        <table>
            <thead><tr id="header-row"><th class="row-label">Category</th></tr></thead>
            <tbody id="score-body"></tbody>
        </table>
        <div id="empty-msg" class="empty-state">No players added. Click "+ Add Player" to begin.</div>
    </div>

    <script>
        const categories = [
            {n: 'Aces (1s)', type: 'upper'}, {n: 'Twos (2s)', type: 'upper'},
            {n: 'Threes (3s)', type: 'upper'}, {n: 'Fours (4s)', type: 'upper'},
            {n: 'Fives (5s)', type: 'upper'}, {n: 'Sixes (6s)', type: 'upper'},
            {n: 'Upper Subtotal', type: 'calc'},
            {n: 'Bonus (63+)', type: 'calc', isBonus: true},
            {n: '3 of a Kind', type: 'lower'}, {n: '4 of a Kind', type: 'lower'},
            {n: 'Full House', type: 'binary', score: 25}, 
            {n: 'Sm Straight', type: 'binary', score: 30}, 
            {n: 'Lg Straight', type: 'binary', score: 40}, 
            {n: 'Yahtzee', type: 'binary', score: 50},
            {n: 'Chance', type: 'lower'},
            {n: 'Yahtzee Bonus', type: 'extra'},
            {n: 'GRAND TOTAL', type: 'grand'}
        ];

        let players = JSON.parse(localStorage.getItem('yt_players_v10')) || [];

        function setTheme(theme) {
            document.getElementById('body').className = theme === 'default' ? '' : theme;
            localStorage.setItem('yt_theme_v10', theme);
        }

        function render() {
            const headerRow = document.getElementById('header-row');
            const scoreBody = document.getElementById('score-body');
            const emptyMsg = document.getElementById('empty-msg');

            if (players.length === 0) {
                headerRow.innerHTML = '<th class="row-label">Category</th>';
                scoreBody.innerHTML = '';
                emptyMsg.style.display = 'block';
                return;
            }

            emptyMsg.style.display = 'none';
            headerRow.innerHTML = '<th class="row-label">Category</th>' + 
                players.map((name, i) => `<th>${name}<button class="btn-remove" onclick="removePlayer(${i})">REMOVE</button></th>`).join('');

            scoreBody.innerHTML = categories.map((cat, cIdx) => `
                <tr class="${cat.type === 'calc' ? 'subtotal' : (cat.type === 'grand' ? 'grand-total' : '')}">
                    <td class="row-label">${cat.n}</td>
                    ${players.map((_, pIdx) => {
                        if (cat.type === 'calc' || cat.type === 'grand') {
                            return `<td id="p${pIdx}-c${cIdx}">0${cat.isBonus ? `<span id="p${pIdx}-needed" class="bonus-needed"></span>` : ''}</td>`;
                        } else if (cat.type === 'binary') {
                            return `<td><button id="p${pIdx}-c${cIdx}" class="btn-toggle" onclick="toggleBinary(${pIdx}, ${cIdx}, ${cat.score})">—</button></td>`;
                        } else if (cat.type === 'extra') {
                            return `<td><div style="display:flex;gap:4px;justify-content:center"><input type="checkbox" id="p${pIdx}-b1" onchange="calc(${pIdx})"> <input type="checkbox" id="p${pIdx}-b2" onchange="calc(${pIdx})"> <input type="checkbox" id="p${pIdx}-b3" onchange="calc(${pIdx})"></div></td>`;
                        } else {
                            return `<td><input type="number" id="p${pIdx}-c${cIdx}" oninput="calc(${pIdx})"></td>`;
                        }
                    }).join('')}
                </tr>
            `).join('');
            loadScores();
        }

        function toggleBinary(pIdx, cIdx, scoreVal) {
            const btn = document.getElementById(`p${pIdx}-c${cIdx}`);
            if (btn.innerText === '—') { btn.innerText = scoreVal; btn.className = 'btn-toggle scored'; }
            else if (btn.innerText == scoreVal) { btn.innerText = '0'; btn.className = 'btn-toggle zeroed'; }
            else { btn.innerText = '—'; btn.className = 'btn-toggle'; }
            calc(pIdx);
        }

        function calc(pIdx) {
            let uSum = 0;
            for(let i=0; i<6; i++) uSum += Number(document.getElementById(`p${pIdx}-c${i}`).value) || 0;
            let uBonus = uSum >= 63 ? 35 : 0;
            document.getElementById(`p${pIdx}-c6`).innerText = uSum;
            document.getElementById(`p${pIdx}-c7`).innerHTML = uBonus + `<span id="p${pIdx}-needed" class="bonus-needed"></span>`;
            
            const needed = document.getElementById(`p${pIdx}-needed`);
            if (needed) needed.innerText = (uSum < 63 && uSum > 0) ? `${63-uSum} more` : (uSum >= 63 ? "✓" : "");

            let lSum = 0;
            for(let i=8; i<15; i++) {
                const el = document.getElementById(`p${pIdx}-c${i}`);
                if (el) lSum += (el.tagName === 'BUTTON') ? (parseInt(el.innerText) || 0) : (Number(el.value) || 0);
            }

            let yBonus = 0;
            const yEl = document.getElementById(`p${pIdx}-c13`);
            const hasY = yEl && yEl.innerText === '50';
            for(let b=1; b<=3; b++) {
                const cb = document.getElementById(`p${pIdx}-b${b}`);
                if (cb) { if (hasY && cb.checked) yBonus += 100; else if (!hasY) cb.checked = false; }
            }

            document.getElementById(`p${pIdx}-c16`).innerText = uSum + uBonus + lSum + yBonus;
            updateLeader();
            saveScores();
        }

        function updateLeader() {
            let max = -1, leaderIdx = -1;
            players.forEach((_, i) => {
                const sEl = document.getElementById(`p${i}-c16`);
                if (!sEl) return;
                const s = Number(sEl.innerText);
                sEl.classList.remove('leader-cell');
                if (s > max && s > 0) { max = s; leaderIdx = i; }
            });
            if (leaderIdx !== -1) document.getElementById(`p${leaderIdx}-c16`).classList.add('leader-cell');
        }

        function addPlayer() {
            const n = prompt("Enter Player Name:");
            if (n) { players.push(n); render(); }
        }

        function removePlayer(idx) {
            if (confirm(`Remove ${players[idx]}?`)) {
                players.splice(idx, 1);
                localStorage.removeItem('yt_scores_v10'); // Reset scores to prevent mapping errors
                render();
            }
        }

        function saveScores() {
            const data = {};
            document.querySelectorAll('input, .btn-toggle').forEach(el => {
                if (el.type === 'checkbox') data[el.id] = el.checked;
                else if (el.tagName === 'BUTTON') data[el.id] = el.innerText;
                else data[el.id] = el.value;
            });
            localStorage.setItem('yt_scores_v10', JSON.stringify(data));
            localStorage.setItem('yt_players_v10', JSON.stringify(players));
        }

        function loadScores() {
            const data = JSON.parse(localStorage.getItem('yt_scores_v10') || "{}");
            const theme = localStorage.getItem('yt_theme_v10') || 'default';
            setTheme(theme);
            document.getElementById('themeSelector').value = theme;

            document.querySelectorAll('input, .btn-toggle').forEach(el => {
                if (data[el.id] !== undefined) {
                    if (el.type === 'checkbox') el.checked = data[el.id];
                    else if (el.tagName === 'BUTTON') {
                        el.innerText = data[el.id];
                        el.className = data[el.id] === '0' ? 'btn-toggle zeroed' : (data[el.id] !== '—' ? 'btn-toggle scored' : 'btn-toggle');
                    }
                    else el.value = data[el.id];
                }
            });
            players.forEach((_, i) => calc(i));
        }

        function resetAllScores() {
            if (confirm("Reset scores for current players?")) {
                localStorage.removeItem('yt_scores_v10');
                render();
            }
        }

        function hardReset() {
            if (confirm("Delete everything?")) {
                localStorage.clear();
                location.reload();
            }
        }

        window.onload = render;
    </script>
</body>
</html>